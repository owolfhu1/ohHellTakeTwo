<!doctype html>
<html>
    <head>
        <title id="title">Orion's Oh Hell</title>
        <script>    /* ---VARIABLES--- */
            let
                title = document.getElementById('title'), turn_indicator, player_hand, opponent_hand, trump_box,
                play_area, opponent_name, player_name, opponent_score, opponent_goal, opponent_tricks, player_score,
                player_goal, player_tricks, lobby, userName = 'GUEST', trump, inPlay, aces_button, player1_tricks,
                player2_tricks, tricks_popup, aceStyle, agreement, follow_suit, pick_opponents_goal;
            const
                SUIT = 1, VALUE = 0, NAME = 0, ID = 1, HAND = 0, OPPONENT_HAND_SIZE = 1, TRUMP = 2, IN_PLAY = 3, TURN = 4,
                PLAYER_STATS = 5, OPPONENT_STATS = 6, SCORE = 0, GOAL = 1, TRICKS = 2, OPPONENT_NAME = 7, PLAYER_1 = 0, PLAYER_2 = 1;
            const alertSound = new Audio('http://owolfhu1.x10host.com/Oh_Hell_solo/img/sound.mp3');
            const smallSound = new Audio('http://owolfhu1.x10host.com/Oh_Hell_solo/img/smallSound.mp3');
            const shuffleSound = new Audio('http://owolfhu1.x10host.com/Oh_Hell_solo/img/shuffle.mp3');
            const secretSound = new Audio('http://owolfhu1.x10host.com/Oh_Hell_solo/img/secret.mp3');
            const HELP_TEXT = `
                <p><b>$instructions: </b>Prints the rules in the chat screen.</p>
                <p><b>$round: </b>Prints the current round (starting at 1 and incrementing each round) in the chat screen.</p>
                <p><b>$tricks: </b>Displays a list of tricks each player has won.</p>
                <p><b>$buzz: </b>Plays a sound to you and your opponent.</p>
                <p><b>$resign: </b>Forfeits the game.</p>
                <p><b>$watch: </b>Followed by a gameId lets you watch that game.</p>
                <p><b>$kick: </b>Kicks all spectators.</p>
                <p><b>$lock: </b>Locks the game from spectators (doesn't kick).</p>
                <p><b>$unlock: </b>Unlocks the game to spectators.</p>
                <p><b>$whisper: </b>Sends a private message to your opponent.</p>
            `;
            const INSTRUCTIONS_TEXT = `

                <h2>THIS IS OUT OF DATE AND NEEDS TO BE UPDATED</h2>

                <p><b>Objective:</b> Score the most points by correctly guessing how many tricks you will win each round.</p>
                <p><b>Picking Your Goal:</b> At the beginning each round you will be prompted a row of buttons to pick your goal with. You cannot agree with your opponent, your goal's must not add up to the round # </p>
                <p><b>Playing a Card:</b> If you are the first to play a card (there is no card in the middle of the card area), you may play any card. If not, you must follow the suit previously played. If you do not have the suit, you must play a joker, otherwise you can play any card.</p>
                <p><b>Winning Tricks:</b> The first card played determines the strong suit, however a trump suit will beat the strong suit. If the second card is the same suit, it will win only if it is a higher card, otherwise the first card wins the trick. If the second card is a different suit, it wins the trick if it is a trump, otherwise loses. If ether card is a joker, the suit is irrelevant, the higher card wins the trick with jokers being between ten and jack. If both cards are jokers, the first card wins the trick.</p>
                <p><b>Scoring:</b> If you guess the correct number of tricks, you will score the number of tricks you won, plus the number of cards you started with, plus 5 for any joker in your tricks.</p>
                <p><b>Game Play:</b> Start each round by picking your goal, then players take turns playing cards until each player is out of cards or neither player can reach their goal. Then a new round is dealt with an increasing or decreasing number of cards. Starting at 1 card each, working your way up to ten cards then back down to one card</p>
            `;
        </script>
        <style>
            html { background: #b03f48; color: #f0f0f0; font-size: 1.2em; line-height: 1; font-family: "Comic Sans MS" }
            .lobby {overflow-y: scroll; margin-left: 500px; height: 500px; width: 400px; background-color: #529848; border:6px dotted #2e2e2e; border-radius: 40px; }
            .chat_input { color: white; }
            .turn_indicator { padding: 20px; text-align: center; }
            .picker:hover { transform: scale(1.05) rotate(1deg); }
            .legal:hover { transform: scale(1.05) rotate(1deg); }
            .picker:active { transform: scale(.94) rotate(-1deg); }
            .legal:active { transform: scale(.94) rotate(-1deg); }
            .cards { padding: 1px; width: 94px; height: 130px; }
            .legal { padding: 1px; width: 94px; height: 130px; }
            .float_left {overflow-y: scroll; float:left; width: 180px; height: 650px; text-align:center; border:6px dotted #2e2e2e; border-radius: 40px; margin: 20px; padding: 10px; background: #529848; line-height: .7; }
            .float_right { float:right; width: 300px; height: 650px; text-align:center; border:6px dotted #2e2e2e; border-radius: 40px; margin: 20px; padding: 10px; background: #529848; }
            .play_area { text-align: center; height: 190px; }
            .player_hand{ text-align:center; }
            .opponent_hand { height: 135px; text-align:center; }
            .back_drop { height: 720px; width: 1620px; margin: 30px; border:6px dotted #b03f48; border-radius: 70px; background: #2e2e2e; }
            .card_area { height: 440px; padding: 115px 0; text-align: center; }
            .aces_button { background-color: #2e2e2e; border: 6px dotted #529848; border-radius: 20px; color: white; margin-top: 10px; padding: 20px 20px; text-align: center; text-decoration: none; display: inline-block; font-size: 20px; font-family: "Comic Sans MS"; line-height: 1px; }
            .log { overflow-y: scroll; overflow-wrap: normal; height: 250px; width: 280px; border: 6px dotted #529848; background: #2e2e2e; border-radius: 20px; font-size: 12px; text-align: left; padding-left: 10px; }
            .chat { overflow-y: scroll; overflow-wrap: normal; height: 300px; width: 280px; border: 6px dotted #529848; background: #2e2e2e; border-radius: 20px; font-size: 12px; text-align: left; padding: 1px; }
            ::-webkit-scrollbar { width: 12px; }
            ::-webkit-scrollbar-track { display: none; }
            ::-webkit-scrollbar-thumb { width: 12px; background-color: #529848; border-radius: 7px; }
            .chat_input { background-color: #2e2e2e; width: 280px; border: 6px dotted #529848; border-radius: 20px; }
            .tricks_popup { display: none; position: fixed; z-index: 1; padding-top: 200px; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; }
            .tricks_popup_content { text-align: center;  background-color: #b03f48; margin: auto; padding: 20px; border: 6px dotted #2e2e2e; border-radius: 40px; width: 60%; }
            .invite_popup { display: none; position: absolute; z-index: 1; padding-top: 45px; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; }
            .invite_popup_content { background-color: #037098; margin: auto; padding: 20px; padding-top: 4px; border: 6px dotted #2e2e2e; border-radius: 40px; width: 520px; height: 660px }
            .invite_divs { border: dotted #037098; background-color: #2e2e2e; border-radius: 10px; margin-top: 7px; margin-bottom: 7px; padding: 8px; padding-top: 2px; padding-bottom: 3px; line-height: 18px; }
            .invite_input { background-color: #037098; border-radius: 6px; color: white; padding-left: 10px; width: 30px }
            .invite_buttons { border: 5px dotted #037098; background-color: #2e2e2e; border-radius: 14px; color: white; font-family: "Comic Sans MS"; padding-bottom: 4px;  margin: 6px; }

            .last_turn_cards {
                display: block;
                z-index: 1;
                position: absolute;
                top: 285px;
            }


        </style>
        <script src="/socket.io/socket.io.js"></script>
        <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
    </head>
    <body>
        <div id="back_drop" class="back_drop">
            <div id="float_left" class="float_left"></div>
            <div id="float_right" class="float_right">
                <div id="log" class="log"></div><br>
                <div id="messages" class="chat"><br><h2>For help type $help.</h2></div><br>
                <form action="">
                    <input id="text" class="chat_input" type="text"/>
                </form>
            </div>
            <div id="card_area" class="card_area"></div>
        </div>
        <div id="tricks_popup" class="tricks_popup">
            <div class="tricks_popup_content">
                <div id="player1_tricks"></div>
                <br>
                <div id="player2_tricks"></div>
            </div>
        </div>
        <div id="invite_popup" class="invite_popup">
            <div id="invite_popup_content" class="invite_popup_content">
            </div>
        </div>
        <div id="last_turn">
        </div>
        <script>

            //connects to server
            let socket = io();

            //prompts user to pick game rules and send and invite.
            const sendInvite = (name, id) => {
                let invite_popup_content = document.getElementById('invite_popup_content');
                let invite_popup = document.getElementById('invite_popup');
                invite_popup_content.innerHTML = `
                <form id="invite_form">
                    <div class="invite_divs">
                        Deck size:
                        <input title="size" type="radio" name="size" value="full" checked> full deck
                        <input type="radio" name="size" value="small"> small deck (8-K with aces)
                    </div>
                    <div class="invite_divs">
                        Aces:
                        <input title="aces" type="radio" name="aces" value="high"> high
                        <input type="radio" name="aces" value="low"> low
                        <input type="radio" name="aces" value="both" checked> both
                    </div>
                    <div class="invite_divs">
                        Pick goal for opponent:
                        <input title="pick_opponents_goal" name="pick_opponents_goal" type="radio" value="on"> on
                        <input name="pick_opponents_goal" type="radio" value="off" checked> off
                    </div>
                    <div class="invite_divs">
                        Goal agreement:
                        <input title="agree" type="radio" name="agree" value="on"> on
                        <input type="radio" name="agree" value="off" checked> off
                    </div>
                    <div class="invite_divs">
                        Following suit required:
                        <input title="follow_suit" type="radio" name="follow_suit" value="on" checked> on
                        <input type="radio" name="follow_suit" value="off"> off
                    </div>
                    <div class="invite_divs">
                        Dealer picks trump:
                        <input title="dealer_picks_trump" type="radio" name="dealer_picks_trump" value="on"> on
                        <input type="radio" name="dealer_picks_trump" value="off" checked> off
                    </div>
                    <div class="invite_divs">
                        Jokers:
                        <input title="jokers" type="radio" name="jokers" value="on" checked> on
                        <input type="radio" name="jokers" value="off"> off &nbsp; &nbsp; &nbsp;
                        Joker value (0 to 10):
                        <input title="joker_value" type="number" class="invite_input" name="joker_value" min="-10" max="10" value="5"><br>
                        Joker bonus on goal only:<br>
                        <input title="jokers_goal_only" type="radio" name="jokers_goal_only" value="on" checked> on
                        <input type="radio" name="jokers_goal_only" value="off"> off
                        <input type="radio" name="jokers_goal_only" value="off/Inverted"> off / inverted value on fail.
                    </div>
                    <div class="invite_divs">
                        <input type="radio" title="who_gets_bid_dif" name="who_gets_bid_dif" value="goal" checked> on goal
                        <input type="radio" name="who_gets_bid_dif" value="fail"> on fail
                        <input type="radio" name="who_gets_bid_dif" value="both"> both: <br>Score(-10 to 10)
                        <input title="bid_dif_multiplier" type="number" class="invite_input" name="bid_dif_multiplier" min="-10" max="10" value="0">
                        x over/under bid value
                    </div>
                    <div class="invite_divs">
                        Failing loses points:
                        <input title="lose_points" type="radio" name="lose_points" value="on"> on
                        <input type="radio" name="lose_points" value="off" checked> off <br>
                        How many points? (1 to 10):
                        <input title="lose_number" type="number" class="invite_input" name="lose_number" min="1" max="10" value="5"><br>
                        Only for point leader?:
                        <input title="leader_only" type="radio" name="leader_only" value="on"> on
                        <input type="radio" name="leader_only" value="off" checked> off
                    </div>
                    <div class="invite_divs">
                        Game progression: &nbsp; &nbsp; &nbsp;
                        Loop: <input type="radio" title="loop" name="loop" value="on" checked> on
                        <input type="radio" name="loop" value="off"> off<br>
                        <input title="progression" type="radio" name="progression" value="high to low"> high to low
                        <input type="radio" name="progression" value="low to high" checked> low to high
                        <input type="radio" name="progression" value="constant"> constant
                        <input type="radio" name="progression" value="random"> random <br>
                        Start value: (1 to 10):
                        <input title="start" type="number" class="invite_input" name="start" min="1" max="10" value="1"> &nbsp; &nbsp;
                        End value: (1 to 10):
                        <input title="finish" type="number" class="invite_input" name="finish" min="1" max="10" value="1">
                    </div>
                    <div class="invite_divs">
                        Bonus points on goal only:
                        <input title="bonus_goal_only" type="radio" name="bonus_goal_only" value="on" checked> on
                        <input type="radio" name="bonus_goal_only" value="off"> off<br>
                        Bonus:
                        <input title="bonus" type="radio" name="bonus" value="off"> off
                        <input type="radio" name="bonus" value="round" checked> round#
                        <input type="radio" name="bonus" value="user"> (1 to 10)
                        <input title="user_bonus" type="number" class="invite_input" name="user_bonus" min="1" max="10" value="5">
                    </div>
                    <div class="invite_divs">
                        Score tricks when:
                        <input title="who_scores_tricks" type="radio" name="who_scores_tricks" value="goal" checked> goal
                        <input type="radio" name="who_scores_tricks" value="fail"> fail
                        <input type="radio" name="who_scores_tricks" value="both"> both<br>
                        Trick multiplier (-5 to 5):
                        <input title="trick_multiplier" type="number" class="invite_input" name="trick_multiplier" min="-5" max="5" value="1">
                    </div>
                </form>
                &nbsp;&nbsp;&nbsp;
                <button class="invite_buttons" id="invite_button">send invite to ${name}</button>
                <button class="invite_buttons" id="randomize_button">send randomized game invite</button>
                <button class="invite_buttons" id="cancel_button">cancel</button>
                `;
                let invite_form = document.getElementById('invite_form');
                let invite_button = document.getElementById('invite_button');
                let randomize_button = document.getElementById('randomize_button');
                let cancel_button = document.getElementById('cancel_button');
                randomize_button.addEventListener('click', () => {
                    socket.emit('pair_request', [id, 'randomize']);
                    invite_popup.style.display = "none";
                });
                invite_button.addEventListener('click', () => {
                    //TODO add validation for user_bonus(1-10) && trick_multiplier(-5-5) && bid_dif_multiplier(-10-10) here and in if(){emit('p_r',[])}
                    if (invite_form.joker_value.value === '') {
                        invite_form.joker_value.value = 5;
                    }
                    invite_form.joker_value.value = Math.round(invite_form.joker_value.value);
                    if (invite_form.lose_number.value === '') {
                        invite_form.lose_number.value = 5;
                    }
                    invite_form.lose_number.value = Math.round(invite_form.lose_number.value);
                    if (invite_form.start.value === '') {
                        invite_form.start.value = 5;
                    }
                    invite_form.start.value = Math.round(invite_form.start.value);
                    if (invite_form.finish.value === '') {
                        invite_form.finish.value = 5;
                    }
                    invite_form.finish.value = Math.round(invite_form.finish.value);
                    if (
                        11 > invite_form.joker_value.value &&
                        invite_form.joker_value.value > -11 &&
                        11 > invite_form.lose_number.value &&
                        invite_form.lose_number.value > -11 &&
                        11 > invite_form.start.value &&
                        invite_form.start.value > 0 &&
                        11 > invite_form.finish.value &&
                        invite_form.finish.value > 0
                    ) {
                        socket.emit('pair_request', [
                            id,     //0
                            invite_form.aces.value,               //1
                            invite_form.jokers.value,             //2
                            invite_form.joker_value.value,        //3
                            invite_form.agree.value,              //4
                            invite_form.follow_suit.value,        //5
                            invite_form.lose_points.value,        //6
                            invite_form.lose_number.value,        //7
                            invite_form.leader_only.value,        //8
                            invite_form.loop.value,               //9
                            invite_form.progression.value,        //10
                            invite_form.start.value,              //11
                            invite_form.finish.value,             //12
                            invite_form.who_scores_tricks.value,  //13
                            invite_form.pick_opponents_goal.value,//14
                            invite_form.dealer_picks_trump.value, //15
                            invite_form.trick_multiplier.value,   //16
                            invite_form.bonus_goal_only.value,    //17
                            invite_form.bonus.value,              //18
                            invite_form.user_bonus.value,         //19
                            invite_form.jokers_goal_only.value,   //20
                            invite_form.who_gets_bid_dif.value,   //21
                            invite_form.bid_dif_multiplier.value, //22
                            invite_form.size.value                //23
                        ]);
                        invite_popup.style.display = "none";
                    }
                });
                cancel_button.addEventListener('click', () => {
                    invite_popup.style.display = "none";
                });
                invite_popup.style.display = "block";
            };

            //checks if card is legal play, returns boolean
            const isLegal = (hand, i) => {

                //if rules say you don't need to follow suit, all moves are legal
                if (!follow_suit) return true;

                //if there is no card in play, all moves are legal
                if (inPlay[SUIT] === 20) return true;

                //if the card to be played is the same suit as the card in play, move is legal
                if (inPlay[SUIT] === hand[i][SUIT]) return true;

                //else check the rest of the players hand
                else {
                    let haveCards = haveCard(hand);

                    //if you don't have any inPlay suit cards or jokers in hand, move is legal
                    if (!haveCards[0] && !haveCards[1]) return true;

                    //if you don't have the suit inPlay and the card you are trying to play is a joker, move is legal
                    if (!haveCards[0] && hand[i][1] === 'joker') return true;

                    //if card inPlay is a joker and you don't have a joker, any move is legal
                    if (inPlay[SUIT] === 'joker' && !haveCards[1]) return true;
                }

                //returns false if all checks fail
                return false
            };

            //checks if you have joker or trump suits in your hand, used by isLegal()
            const haveCard = hand => {
                let jokers = false;
                let suits = false;
                for (let i = 0; i<hand.length; i++){
                    if (hand[i][SUIT] === inPlay[SUIT]) suits = true;
                    if (hand[i][SUIT] === 'joker') jokers = true;
                }
                return [suits, jokers];
            };

            //returns html for cards which can't be played
            const cardImg = card => `<img class="cards" src= "http://owolfhu1.x10host.com/Oh_Hell_solo/img/card${card[SUIT]}${card[VALUE]}.png" id="${card[SUIT]}${card[VALUE]}" >`;

            //returns html for cards which can be played
            const legalCardImg = card => `<img class="legal" src= "http://owolfhu1.x10host.com/Oh_Hell_solo/img/card${card[SUIT]}${card[VALUE]}.png" id="${card[SUIT]}${card[VALUE]}" >`;

            //returns html for inPlay and trump cards
            const bigCardImg = card => `<img style="width: 140px; height: inherit" src= "http://owolfhu1.x10host.com/Oh_Hell_solo/img/card${card[SUIT]}${card[VALUE]}.png" id="${card[SUIT]}${card[VALUE]}" >`;

            //what happens when you press enter in the chat input.
            $('form').submit( () => {
                let text = $('#text').val();
                /*s*/if (text === '$help') document.getElementById('messages').innerHTML += HELP_TEXT;
                else if (text === '$instructions') document.getElementById('messages').innerHTML += INSTRUCTIONS_TEXT;
                else if (text.substring(0, 8) === '$whisper' && userName !== 'GUEST') socket.emit('whisper', text.substring(9, text.length));
                else if (text === '$kick')socket.emit('kick');
                else if (text === '$lock') socket.emit('lock');
                else if (text === '$round') socket.emit('round_check');
                else if (text === '$unlock') socket.emit('unlock');
                else if (text === '$resign')socket.emit('resign');
                else if (text === '$tricks')socket.emit('tricks');
                else if (text === '$board') socket.emit('leaderboard');
                else if (text === '$buzz') socket.emit('buzz');
                else if (text === '$$RESTART') socket.emit('restart');
                else if (text.substring(0, 7) === '$watch ')socket.emit('watch_game', text.substring(7, text.length));
                else { socket.emit('message', '<p>' + userName + ': ' + text + '</p>'); $('#text').val(''); }
                return false;
            });

            //creates form for logging in and user creation
            socket.on('setup_login', () => {
                lobby.innerHTML = `<br><br>
                        user name: <input type="text" id="userName"><br><br>
                        password: <input type="password" id="password"><br><br><br><br>
                        <button style="font-family: 'Comic Sans MS'; color: white ; background-color: #2e2e2e ; border:31px dashed #b03f48; border-radius: 150px; height: 300px; width: 300px" id="login"><h1>Login<br>or<br>Create</h1></button>
                `;
                document.getElementById('login').addEventListener('click', () => {
                    let userName = document.getElementById('userName').value;
                    let password = document.getElementById('password').value;
                    if (userName.length > 10) {
                        alert('Username too long. (10 char max)');
                    } else if (userName.length < 1) {
                        alert('Please enter a username.');
                    } else {
                        socket.emit('login_request', [userName, password]);
                    }
                });
            });

            //plays a shuffle sound to indicate a new hand has been dealt
            socket.on('shuffle', () => shuffleSound.play());

            //displays lobby (list of buttons representing players waiting to play a game)
            socket.on('updateLobby', users => {
                //displays buttons
                let body = '<ul>';
                for (let i = 0; i < users[ID].length; i++) {
                    body += `<p><button style="background-color: #2e2e2e; border: 4px dotted #529848; border-radius: 10px; color: white; padding: 10px 10px;" id="${i}">${users[NAME][i]}</button></p>`;
                }
                body += '</ul>';
                lobby.innerHTML = body;

                //adds event to send pair request when button is pushed
                for(let i = 0; i< users[ID].length; i++) {
                    document.getElementById(i.toString()).addEventListener('click', () => {
                        sendInvite(users[NAME][i],users[ID][i])
                    });
                }
                document.getElementById('float_left').innerHTML = users[2];
            });

            //gets pair request and confirms user
            socket.on('rePair', pair => {
                if (pair[1] === pair[0][0]) alert(`You can't play yourself! If you would like to try a solo version of this game, go to: owolfhu1.x10host.com/Oh_Hell_solo enjoy!`);
                else {
                    secretSound.play();
                    let invite_popup_content = document.getElementById('invite_popup_content');
                    let invite_popup = document.getElementById('invite_popup');
                    if (pair[0][1] === 'randomize'){
                        invite_popup_content.innerHTML = `
                        <b>${pair[2]}</u></b> would like to play a randomized game.<br><br><br>
                        <div class="invite_buttons"><br>&nbsp;&nbsp;Rules will be set and explained after you accept!<br><br></div>
                        <br><br>
                    `;
                    } else {
                        let INVITE_FORM = 0;
                        let game ={};
                        game.aces                  =         pair[INVITE_FORM] [1]   ;
                        game.jokers                =         pair[INVITE_FORM] [2]   ;
                        game.joker_value           =  Number(pair[INVITE_FORM] [3])  ;
                        game.agreement             =         pair[INVITE_FORM] [4]   ;
                        game.follow_suit           =         pair[INVITE_FORM] [5]   ;
                        game.lose_points           =         pair[INVITE_FORM] [6]   ;
                        game.lose_number           =  Number(pair[INVITE_FORM] [7])  ;
                        game.leader_only           =         pair[INVITE_FORM] [8]   ;
                        game.loop                  =         pair[INVITE_FORM] [9]   ;
                        game.progression           =         pair[INVITE_FORM] [10]  ;
                        game.start                 =  Number(pair[INVITE_FORM] [11]) ;
                        game.finish                =  Number(pair[INVITE_FORM] [12]) ;
                        game.who_scores_tricks     =         pair[INVITE_FORM] [13]  ;
                        game.pick_opponents_goal   =         pair[INVITE_FORM] [14]  ;
                        game.dealer_picks_trump    =         pair[INVITE_FORM] [15]  ;
                        game.trick_multiplier      =  Number(pair[INVITE_FORM] [16]) ;
                        game.bonus_goal_only       =         pair[INVITE_FORM] [17]  ;
                        game.bonus                 =         pair[INVITE_FORM] [18]  ;
                        game.user_bonus            =  Number(pair[INVITE_FORM] [19]) ;
                        game.jokers_goal_only      =         pair[INVITE_FORM] [20]  ;
                        game.who_gets_bid_dif      =         pair[INVITE_FORM] [21]  ;
                        game.bid_dif_multiplier    =  Number(pair[INVITE_FORM] [22]) ;
                        game.size                  =         pair[INVITE_FORM] [23]  ;

                        let text = '';
                        if (game.size === 'full') {
                            text += '<p>The game will use a full deck of cards.</p>';
                        } else {
                            text += '<p>The game will use a small deck of cards(8-K with aces).</p>'
                        }
                        let aceText;
                        if (game.aces === 'both'){
                            aceText = 'high and low';
                        } else {
                            aceText = game.aces;
                        }
                        text += `<p>Aces are ${aceText}.</p>`;
                        text += `<p>Jokers are ${game.jokers}.</p>`;
                        if (game.jokers === 'on' && game.joker_value !== 0){
                            if (game.jokers_goal_only === 'off/Inverted') {
                                text += `<p>You will get ${game.joker_value} bonus points for jokers you have won on goal and ${game.joker_value * -1} per joker when you fail.</p>`;
                            } else if (game.jokers_goal_only === 'off') {
                                text += `<p>You will get ${game.joker_value} bonus points for jokers you have won, always.</p>`;
                            } else if (game.jokers_goal_only === 'on') {
                                text += `<p>You will get ${game.joker_value} bonus points for jokers you have won, on goal.</p>`;
                            }
                        }
                        if (game.pick_opponents_goal === 'on'){
                            text += `<p>You will pick your opponent's goals.</p>`;
                        } else {
                            text += `<p>You will pick your own goals.</p>`;
                        }
                        text += `<p>Dealer picks trump: ${game.dealer_picks_trump}</p>`;
                        text += `<p>Agreement when picking goal: ${game.agreement}</p>`;
                        text += `<p>Following suit required: ${game.follow_suit}</p>`;
                        if (game.lose_points === 'on'){
                            text += '<p>';
                            if (game.leader_only === 'on'){
                                text += 'If you are the point leader, ';
                            }
                            text += `you will lose ${game.lose_number} points for incorrect guesses</p>`;
                        }
                        if (game.trick_multiplier !== 0) {
                            if (game.who_scores_tricks === 'goal') {
                                text += `<p>Each trick adds ${game.trick_multiplier} to score only on correct guess</p>`;
                            } else if (game.who_scores_tricks === 'both') {
                                text += `<p>Each trick adds ${game.trick_multiplier} to score regardless of goal</p>`;
                            } else if (game.who_scores_tricks === 'fail') {
                                text += `<p>Each trick adds ${game.trick_multiplier} to score when you do not achieve your goal</p>`;
                            }
                        }
                        if (game.bonus !== 'off') {
                            let goalText = 'regardless of goal';
                            if (game.bonus_goal_only === 'on') goalText = 'on goal only';
                            if (game.bonus === 'round') {
                                text += `<p>You will get the round# in points ${goalText}</p>`
                            } else if (game.bonus === 'user') {
                                text += `<p>You will get ${game.user_bonus} points ${goalText}</p>`
                            }
                        }
                        if (game.bid_dif_multiplier !== 0) {
                            if (game.who_gets_bid_dif === 'goal') {
                                text += `<p>You will get ${game.bid_dif_multiplier} x how much the round is over/under bid; score on goal</p>`
                            } else if (game.who_gets_bid_dif === 'both') {
                                text += `<p>You will get ${game.bid_dif_multiplier} x how much the round is over/under bid; score regardless of goal</p>`
                            } else if (game.who_gets_bid_dif === 'fail') {
                                text += `<p>You will get ${game.bid_dif_multiplier} x how much the round is over/under bid; score when you do not achieve your goal</p>`
                            }
                        }
                        if (game.progression === 'constant'){
                            text += `<p>Game progression: constant rounds of ${game.start} cards.</p><p>Game will end after ${game.finish} rounds.</p>`;
                        } else if (game.progression === 'random') {
                            text += `<p>Game progression: random, starting at round ${game.start}.</p><p>Game will end after ${game.finish} rounds.</p>`;
                        } else {
                            text += `<p>Game progression: ${game.progression}, loop ${game.loop}.</p>`;
                            text += `<p>Starting at round ${game.start} and ending at round ${game.finish}.</p>`;
                        }

                        invite_popup_content.innerHTML = `
                            <div class="invite_divs"><b>${pair[2]}</b> would like to play.</div>
                            <div class="invite_divs">
                                ${text}
                            </div>

                        `;
                    }
                    invite_popup_content.innerHTML += `
                        <button class="invite_buttons" id="accept_button"><h1> &nbsp;&nbsp;accept&nbsp;&nbsp; </h1></button>
                        <button class="invite_buttons" id="decline_button"><h1> &nbsp;&nbsp;decline&nbsp;&nbsp; </h1></button>
                    `;
                    let accept_button = document.getElementById('accept_button');
                    let decline_button = document.getElementById('decline_button');
                    accept_button.addEventListener('click', () => {
                        socket.emit('finalPair', pair);
                        invite_popup.style.display = "none";
                    });
                    decline_button.addEventListener('click', () => {
                        socket.emit('decline', pair[1]);
                        invite_popup.style.display = "none";
                    });
                    invite_popup.style.display = "block";
                }
            });

            //prints chat received by server in chat window
            socket.on('receive_message', msg => {
                let body = document.getElementById('messages');
                smallSound.play();
                body.innerHTML += `<p>${msg}</p>`;
                body.scrollTop = body.scrollHeight;
            });

            //prints log received by server in log window
            socket.on('receive_log', msg => {
                let body = document.getElementById('log');
                body.innerHTML += `<p>${msg}</p>`;
                body.scrollTop = body.scrollHeight;
            });

            //display previous trick
            socket.on('last_turn_cards', cards => {
                let last_turn = document.getElementById('last_turn');

                last_turn.innerHTML = `

                    <img class="last_turn_cards" style="left: 470px;" src= "http://owolfhu1.x10host.com/Oh_Hell_solo/img/card${cards[0][1]}${cards[0][0]}.png" id="last1">
                    <img class="last_turn_cards" style="left: 500px;" src= "http://owolfhu1.x10host.com/Oh_Hell_solo/img/card${cards[1][1]}${cards[1][0]}.png" id="last2">

                `;

                document.getElementById('last1').addEventListener('click', () => { last_turn.innerHTML = ''});
                document.getElementById('last2').addEventListener('click', () => { last_turn.innerHTML = ''});


            });

            //remove previous trick
            socket.on('last_turn_cards_off', () => {
                let last_turn = document.getElementById('last_turn');

                last_turn.innerHTML = '';
            });

            //gets DOM ready for a game and sets id getElementById variables
            socket.on('setup_game', id => {
                document.getElementById('card_area').innerHTML = `
                    <div id="opponent_hand" class="opponent_hand"></div>
                    <div id="play_area" class="play_area"></div>
                    <div id="player_hand" class="player_hand"></div>
                    <div id="turn_indicator" class="turn_indicator"></div>
                `;
                document.getElementById('float_left').innerHTML = `
                    <h2 id="opponent_name"></h2>
                    <p id="opponent_score"></p>
                    <p id="opponent_goal"></p>
                    <p id="opponent_tricks"></p>
                    <h2 id="player_name"></h2>
                    <p id="player_score"></p>
                    <p id="player_goal"></p>
                    <p id="player_tricks"></p><p></p>
                    <div id="aces"></div><p></p>
                    <h2>Trump suit</h2><p></p>
                    <div id="trump_box" class="trump_box"></div>
                `;
                document.getElementById('aces').innerHTML = `<button id="aces_button" class="aces_button">Aces low</button>`;
                player_hand = document.getElementById('player_hand');
                opponent_hand = document.getElementById('opponent_hand');
                trump_box = document.getElementById('trump_box');
                play_area = document.getElementById('play_area');
                opponent_name = document.getElementById('opponent_name');
                player_name = document.getElementById('player_name');
                opponent_score = document.getElementById('opponent_score');
                opponent_goal = document.getElementById('opponent_goal');
                opponent_tricks = document.getElementById('opponent_tricks');
                player_score = document.getElementById('player_score');
                player_goal = document.getElementById('player_goal');
                player_tricks = document.getElementById('player_tricks');
                turn_indicator = document.getElementById('turn_indicator')
            });

            socket.on('pick_trump', info => {
                let showHand = '';
                for (let i = 0; i < info[HAND].length; i++) showHand += cardImg(info[HAND][i]);
                let showPicker = '';
                if (info[TURN]) {
                    showPicker = `
                        <img class="picker" style="width: 100px; height: 100px; border: 6px dotted #529848; border-radius: 22px; background-color: #2e2e2e;" src= "http://owolfhu1.x10host.com/Oh_Hell_solo/img/diamonds.png" id="diamonds" > &nbsp; &nbsp;
                        <img class="picker" style="width: 100px; height: 100px; border: 6px dotted #529848; border-radius: 22px; background-color: #2e2e2e;" src= "http://owolfhu1.x10host.com/Oh_Hell_solo/img/clubs.png" id="clubs" > &nbsp; &nbsp;
                        <img class="picker" style="width: 100px; height: 100px; border: 6px dotted #529848; border-radius: 22px; background-color: #2e2e2e;" src= "http://owolfhu1.x10host.com/Oh_Hell_solo/img/hearts.png" id="hearts" > &nbsp; &nbsp;
                        <img class="picker" style="width: 100px; height: 100px; border: 6px dotted #529848; border-radius: 22px; background-color: #2e2e2e;" src= "http://owolfhu1.x10host.com/Oh_Hell_solo/img/spades.png" id="spades" >
                    `;
                }
                if(info[TURN]) document.getElementById('opponent_hand').innerHTML = '<h1>Which suit should be trump?</h1>';
                else document.getElementById('opponent_hand').innerHTML = '';
                if (info[TURN]) {
                    title.innerHTML = "(Your Turn!) Orion's Oh Hell";
                    turn_indicator.innerHTML = "<h1>! ! YOUR TURN ! !</h1>";
                } else {
                    title.innerHTML = "Orion's Oh Hell";
                    turn_indicator.innerHTML = '';
                }
                player_hand.innerHTML = showHand;
                trump_box.innerHTML = '';
                play_area.innerHTML = showPicker;
                opponent_name.innerHTML = info[OPPONENT_NAME];
                player_name.innerHTML = userName;
                opponent_score.innerHTML = `Score: ${info[OPPONENT_STATS][SCORE]}`;
                opponent_goal.innerHTML = `Goal: ${info[OPPONENT_STATS][GOAL]}`;
                opponent_tricks.innerHTML = `Tricks: ${info[OPPONENT_STATS][TRICKS]}`;
                player_score.innerHTML = `Score: ${info[PLAYER_STATS][SCORE]}`;
                player_goal.innerHTML = `Goal: ${info[PLAYER_STATS][GOAL]}`;
                player_tricks.innerHTML = `Tricks: ${info[PLAYER_STATS][TRICKS]}`;
                if (info[TURN]) {
                    document.getElementById('hearts').addEventListener('click', () => socket.emit('pick_trump', 'hearts'));
                    document.getElementById('diamonds').addEventListener('click', () => socket.emit('pick_trump', 'diamonds'));
                    document.getElementById('spades').addEventListener('click', () => socket.emit('pick_trump', 'spades'));
                    document.getElementById('clubs').addEventListener('click', () => socket.emit('pick_trump', 'clubs'));
                }
            });

            //receives information about the game and displays it along with a row of buttons for players to pick there goal with
            socket.on('picker', info => {
                trump = info[TRUMP];
                inPlay = info[IN_PLAY];
                let showHand = '';
                for (let i = 0; i < info[HAND].length; i++) showHand += cardImg(info[HAND][i]);
                let showPicker = '';
                if (info[TURN]) {
                    for (let i = 0; i < info[OPPONENT_HAND_SIZE]+1; i++) {
                        if (pick_opponents_goal){
                            if (i + info[PLAYER_STATS][GOAL] === info[OPPONENT_HAND_SIZE]) {
                                if (agreement) {
                                    showPicker += `<img class="picker" src= "http://owolfhu1.x10host.com/Oh_Hell_solo/img/die${i}.png" id="picker${i}" >`;
                                } else {
                                    showPicker += `<img src= "http://owolfhu1.x10host.com/Oh_Hell_solo/img/die${i}.png" id="picker${i}" >`;
                                }
                            }
                            else showPicker += `<img class="picker" src= "http://owolfhu1.x10host.com/Oh_Hell_solo/img/die${i}.png" id="picker${i}" >`;
                        } else {
                            if (i + info[OPPONENT_STATS][GOAL] === info[OPPONENT_HAND_SIZE]) {
                                if (agreement) {
                                    showPicker += `<img class="picker" src= "http://owolfhu1.x10host.com/Oh_Hell_solo/img/die${i}.png" id="picker${i}" >`;
                                } else {
                                    showPicker += `<img src= "http://owolfhu1.x10host.com/Oh_Hell_solo/img/die${i}.png" id="picker${i}" >`;
                                }
                            }
                            else showPicker += `<img class="picker"  src= "http://owolfhu1.x10host.com/Oh_Hell_solo/img/die${i}.png" id="picker${i}" >`;
                        }
                        showPicker += '&nbsp;';
                    }
                }
                if(info[TURN]){

                    if (pick_opponents_goal) {
                        document.getElementById('opponent_hand').innerHTML = `<h1>Pick a goal for ${info[OPPONENT_NAME]}:</h1>`;
                    } else {
                        document.getElementById('opponent_hand').innerHTML = '<h1>How many tricks will you win?</h1>';
                    }
                }
                else document.getElementById('opponent_hand').innerHTML = '';
                if (info[TURN]) {
                    title.innerHTML = "(Your Turn!) Orion's Oh Hell";
                    turn_indicator.innerHTML = "<h1>! ! YOUR TURN ! !</h1>";
                } else {
                    title.innerHTML = "Orion's Oh Hell";
                    turn_indicator.innerHTML = '';
                }
                player_hand.innerHTML = showHand;
                trump_box.innerHTML = bigCardImg(trump);
                play_area.innerHTML = showPicker;
                opponent_name.innerHTML = info[OPPONENT_NAME];
                player_name.innerHTML = userName;
                opponent_score.innerHTML = `Score: ${info[OPPONENT_STATS][SCORE]}`;
                opponent_goal.innerHTML = `Goal: ${info[OPPONENT_STATS][GOAL]}`;
                opponent_tricks.innerHTML = `Tricks: ${info[OPPONENT_STATS][TRICKS]}`;
                player_score.innerHTML = `Score: ${info[PLAYER_STATS][SCORE]}`;
                player_goal.innerHTML = `Goal: ${info[PLAYER_STATS][GOAL]}`;
                player_tricks.innerHTML = `Tricks: ${info[PLAYER_STATS][TRICKS]}`;
                if (info[TURN]) for (let i = 0; i < info[OPPONENT_HAND_SIZE]+1; i++) document.getElementById(`picker${i}`).addEventListener('click', () => socket.emit('pick', i));
            });

            //receives information about the game and displays it along with setting up cards to be clicked
            socket.on('info', info => {
                trump = info[TRUMP];
                inPlay = info[IN_PLAY];
                let showHand = '';
                if (info[TURN]){
                    for (let i = 0; i < info[HAND].length; i++){
                        if (isLegal(info[HAND], i)) showHand += legalCardImg(info[HAND][i]);
                        else showHand += cardImg(info[HAND][i]);
                    }
                } else for (let i = 0; i < info[HAND].length; i++) showHand += cardImg(info[HAND][i]);
                let showOpponentHand = '';
                for (let i = 0; i < info[OPPONENT_HAND_SIZE]; i++) showOpponentHand += `<img class="cards" src= "http://owolfhu1.x10host.com/Oh_Hell_solo/img/card_back.png" >`;
                if (info[TURN]) {
                    title.innerHTML = "(Your Turn!) Orion's Oh Hell";
                    turn_indicator.innerHTML = "<h1>! ! YOUR TURN ! !</h1>";
                    alertSound.play();
                } else {
                    turn_indicator.innerHTML = '';
                    title.innerHTML = "Orion's Oh Hell";
                }
                player_hand.innerHTML = showHand;
                opponent_hand.innerHTML = showOpponentHand;
                trump_box.innerHTML = bigCardImg(trump);
                play_area.innerHTML = bigCardImg(inPlay);
                opponent_name.innerHTML = info[OPPONENT_NAME];
                player_name.innerHTML = userName;
                opponent_score.innerHTML = `Score: ${info[OPPONENT_STATS][SCORE]}`;
                opponent_goal.innerHTML = `Goal: ${info[OPPONENT_STATS][GOAL]}`;
                opponent_tricks.innerHTML = `Tricks: ${info[OPPONENT_STATS][TRICKS]}`;
                player_score.innerHTML = `Score: ${info[PLAYER_STATS][SCORE]}`;
                player_goal.innerHTML = `Goal: ${info[PLAYER_STATS][GOAL]}`;
                player_tricks.innerHTML = `Tricks: ${info[PLAYER_STATS][TRICKS]}`;
                if (info[TURN]) for (let i = 0; i < info[HAND].length; i++) {
                    document.getElementById(info[HAND][i][SUIT] + info[HAND][i][VALUE]).addEventListener('click', () => {
                        if (isLegal(info[HAND], i)) socket.emit('play_card', i);
                    });
                }
            });

            //gets DOM ready for lobby
            socket.on('setup_lobby', () => {
                document.getElementById('card_area').innerHTML = `<div class="lobby" id="lobby"></div>`;
                document.getElementById('float_left').innerHTML = '';
                lobby = document.getElementById('lobby');
            });

            //plays a sound at request of the server at the request of ether player in a game to get players attention
            socket.on('buzzed', () => secretSound.play());

            //prints player information to console
            socket.on('leaderboard', board => console.log(board));

            //sets displays game for spectator mode
            socket.on('spy_setup', spyInfo => {
                document.getElementById('aces').innerHTML = '';
                let showPlayer1 = '';
                let showPlayer2 = '';
                for (let i = 0; i < spyInfo[PLAYER_1][HAND].length; i++) showPlayer1 += cardImg(spyInfo[PLAYER_1][HAND][i]);
                for (let i = 0; i < spyInfo[PLAYER_2][HAND].length; i++) showPlayer2 += cardImg(spyInfo[PLAYER_2][HAND][i]);
                player_hand.innerHTML = showPlayer1;
                opponent_hand.innerHTML = showPlayer2;
                opponent_name.innerHTML = spyInfo[PLAYER_1][OPPONENT_NAME];
                player_name.innerHTML = spyInfo[PLAYER_2][OPPONENT_NAME];
                opponent_score.innerHTML = `Score: ${spyInfo[PLAYER_2][PLAYER_STATS][SCORE]}`;
                opponent_goal.innerHTML = `Goal: ${spyInfo[PLAYER_2][PLAYER_STATS][GOAL]}`;
                opponent_tricks.innerHTML = `Tricks: ${spyInfo[PLAYER_2][PLAYER_STATS][TRICKS]}`;
                player_score.innerHTML = `Score: ${spyInfo[PLAYER_1][PLAYER_STATS][SCORE]}`;
                player_goal.innerHTML = `Goal: ${spyInfo[PLAYER_1][PLAYER_STATS][GOAL]}`;
                player_tricks.innerHTML = `Tricks: ${spyInfo[PLAYER_1][PLAYER_STATS][TRICKS]}`;
                trump_box.innerHTML = bigCardImg(spyInfo[PLAYER_1][TRUMP]);
                play_area.innerHTML = bigCardImg(spyInfo[PLAYER_2][IN_PLAY]);
                if (spyInfo[PLAYER_1][TURN]) player_name.innerHTML += '(turn)';
                if (spyInfo[PLAYER_2][TURN]) opponent_name.innerHTML += '(turn)';
            });

            //gets userName from server after login
            socket.on('set_user_name', name => { userName = name; });

            socket.on('tricks', info => {
                player1_tricks = document.getElementById('player1_tricks');
                player2_tricks = document.getElementById('player2_tricks');
                tricks_popup = document.getElementById('tricks_popup');

                //fill in trick divs
                player1_tricks.innerHTML = info[0] + "'s tricks:<br>";
                player2_tricks.innerHTML = info[1] + "'s tricks:<br>";
                for (let i = 0; i < info[2].length; i++){
                    player1_tricks.innerHTML += cardImg(info[2][i]);
                }
                for (let i = 0; i < info[3].length; i++){
                    player2_tricks.innerHTML += cardImg(info[3][i]);
                }

                //display pop up
                tricks_popup.style.display = "block";

                // When the user clicks anywhere outside of the tricks_popup, close it
                window.onclick = function(event) {
                    if (event.target === tricks_popup) {
                        tricks_popup.style.display = "none";
                    }
                }
            });

            socket.on('ace_style', style => {
                aceStyle = style;
                aces_button = document.getElementById('aces_button');
                if (style === 'high') {
                    aces_button.innerHTML = 'Aces high';
                } else if (style === 'both') {
                    aces_button.addEventListener('click', function () {
                        if (aces_button.innerHTML === 'Aces low') socket.emit('aces_high');
                        if (aces_button.innerHTML === 'Aces high') socket.emit('aces_low');
                    });
                    socket.on('lowAce', function () {
                        aces_button.innerHTML = 'Aces low';
                        smallSound.play();
                    });
                    socket.on('highAce', function () {
                        aces_button.innerHTML = 'Aces high';
                        smallSound.play();
                    });
                }
            });

            socket.on('set_ace_button', value => { aces_button.innerHTML = value })

            socket.on('set_agreement', onOff => {
                if (onOff === 'on') agreement = true;
                if (onOff === 'off') agreement = false;
            });

            socket.on('set_follow_suit', onOff => {
                if (onOff === 'on') follow_suit = true;
                if (onOff === 'off') follow_suit = false;
            });

            socket.on('set_pick_opponents_goal', onOff => {
                if (onOff === 'on') pick_opponents_goal = true;
                if (onOff === 'off') pick_opponents_goal = false;
            });

            socket.on('clear_log', () => { document.getElementById('log').innerHTML = ''; });

        </script>
    </body>
</html>


